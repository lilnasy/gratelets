From b33be81bac076e9b06e7c92372fb28d62479c8d8 Mon Sep 17 00:00:00 2001
From: Arsh <69170106+lilnasy@users.noreply.github.com>
Date: Wed, 30 Jul 2025 17:14:23 +0000
Subject: [PATCH 3/3] adjust package

---
 packages/integrations/cloudflare/src/index.ts             | 8 ++++----
 .../integrations/cloudflare/src/utils/image-config.ts     | 5 +++--
 2 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/packages/integrations/cloudflare/src/index.ts b/packages/integrations/cloudflare/src/index.ts
index b9c3c3122..c049b95a3 100644
--- a/packages/integrations/cloudflare/src/index.ts
+++ b/packages/integrations/cloudflare/src/index.ts
@@ -202,7 +202,7 @@ export default function createIntegration(args?: Options): AstroIntegration {
 	let platformProxy: PlatformProxy;
 
 	return {
-		name: '@astrojs/cloudflare',
+		name: "astro-cloudflare-websocket",
 		hooks: {
 			'astro:config:setup': ({
 				command,
@@ -276,7 +276,7 @@ export default function createIntegration(args?: Options): AstroIntegration {
 					addWatchFile(new URL('./wrangler.jsonc', config.root));
 				}
 				addMiddleware({
-					entrypoint: '@astrojs/cloudflare/entrypoints/middleware.js',
+					entrypoint: new URL("./entrypoints/middleware.ts", import.meta.url),
 					order: 'pre',
 				});
 				if (command === 'dev') {
@@ -304,8 +304,8 @@ export default function createIntegration(args?: Options): AstroIntegration {
 				}
 
 				setAdapter({
-					name: '@astrojs/cloudflare',
-					serverEntrypoint: customWorkerEntryPoint ?? '@astrojs/cloudflare/entrypoints/server.js',
+					name: "astro-cloudflare-websocket",
+					serverEntrypoint: customWorkerEntryPoint ?? new URL("./entrypoints/server.ts", import.meta.url),
 					exports: [...new Set(['default', ...(args?.workerEntryPoint?.namedExports ?? [])])],
 					adapterFeatures: {
 						edgeMiddleware: false,
diff --git a/packages/integrations/cloudflare/src/utils/image-config.ts b/packages/integrations/cloudflare/src/utils/image-config.ts
index 967b1b014..5b389a095 100644
--- a/packages/integrations/cloudflare/src/utils/image-config.ts
+++ b/packages/integrations/cloudflare/src/utils/image-config.ts
@@ -1,5 +1,6 @@
 import type { AstroConfig, AstroIntegrationLogger, HookParameters } from 'astro';
 import { passthroughImageService, sharpImageService } from 'astro/config';
+import { fileURLToPath } from "node:url"
 
 export type ImageService = 'passthrough' | 'cloudflare' | 'compile' | 'custom';
 
@@ -19,7 +20,7 @@ export function setImageConfig(
 				service:
 					command === 'dev'
 						? sharpImageService()
-						: { entrypoint: '@astrojs/cloudflare/image-service' },
+						: { entrypoint: fileURLToPath(new URL('../entrypoints/image-service.ts', import.meta.url)) },
 			};
 
 		case 'compile':
@@ -27,7 +28,7 @@ export function setImageConfig(
 				...config,
 				service: sharpImageService(),
 				endpoint: {
-					entrypoint: command === 'dev' ? undefined : '@astrojs/cloudflare/image-endpoint',
+					entrypoint: command === 'dev' ? undefined : fileURLToPath(new URL('../entrypoints/image-endpoint.ts', import.meta.url)),
 				},
 			};
 
-- 
2.50.1

